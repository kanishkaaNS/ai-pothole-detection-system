<!DOCTYPE html>
<html>
<head>
    <title>Pothole Monitoring Dashboard</title>
    <meta charset="utf-8" />

    <link rel="stylesheet"
        href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        #sidebar {
            width: 320px;
            background: #1e293b;
            color: white;
            padding: 20px;
            box-sizing: border-box;
        }

        #sidebar h2 {
            margin-top: 0;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: #334155;
            padding: 12px;
            margin-bottom: 12px;
            border-radius: 8px;
        }

        .stat-box h3 {
            margin: 0;
            font-size: 14px;
            color: #cbd5e1;
        }

        .stat-box p {
            margin: 5px 0 0;
            font-size: 18px;
            font-weight: bold;
        }

        #map {
            flex: 1;
        }

        /* Legend */
        #legend {
            position: absolute;
            bottom: 20px;
            left: 350px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            box-shadow: 0 0 8px rgba(0,0,0,0.2);
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .legend-color {
            width: 15px;
            height: 15px;
            margin-right: 8px;
            border-radius: 50%;
        }
    </style>
</head>

<body>

<div id="sidebar">
    <h2>AI Pothole Monitoring System</h2>

    <div class="stat-box">
        <h3>Total Potholes</h3>
        <p id="totalCount">0</p>
    </div>

    <div class="stat-box">
        <h3>High Severity</h3>
        <p id="highCount">0</p>
    </div>

    <div class="stat-box">
        <h3>Medium Severity</h3>
        <p id="mediumCount">0</p>
    </div>

    <div class="stat-box">
        <h3>Low Severity</h3>
        <p id="lowCount">0</p>
    </div>
</div>

<div id="map"></div>

<div id="legend">
    <div class="legend-item">
        <div class="legend-color" style="background:red;"></div> High
    </div>
    <div class="legend-item">
        <div class="legend-color" style="background:orange;"></div> Medium
    </div>
    <div class="legend-item">
        <div class="legend-color" style="background:green;"></div> Low
    </div>
</div>

<script>

var map = L.map('map').setView([13.0317, 77.6098], 15);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

function getMarkerIcon(color) {
    return L.icon({
        iconUrl: `https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-${color}.png`,
        shadowUrl: 'https://unpkg.com/leaflet/dist/images/marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34]
    });
}

let total = 0;
let high = 0;
let medium = 0;
let low = 0;

fetch('/api/potholes')
.then(res => res.json())
.then(data => {

    total = data.length;

    data.forEach(p => {

        let color;

        if (p.severity_score >= 0.7) {
            color = "red";
            high++;
        } else if (p.severity_score >= 0.4) {
            color = "orange";
            medium++;
        } else {
            color = "green";
            low++;
        }

        let marker = L.marker(
            [p.latitude, p.longitude],
            { icon: getMarkerIcon(color) }
        ).addTo(map);

        marker.bindPopup(`
            <b>Pothole ID:</b> ${p.id}<br>
            <b>Severity:</b> ${p.severity_score.toFixed(2)}<br>
            <b>Frames:</b> ${p.frame_count}<br>
            <b>Date:</b> ${p.timestamp}
        `);
    });

    document.getElementById("totalCount").innerText = total;
    document.getElementById("highCount").innerText = high;
    document.getElementById("mediumCount").innerText = medium;
    document.getElementById("lowCount").innerText = low;

});

</script>

</body>
</html>